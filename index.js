!function(t,s){t&&!t.getElementById("livereloadscript")&&((s=t.createElement("script")).async=1,s.src="//"+(self.location.host||"localhost").split(":")[0]+":35729/livereload.js?snipver=1",s.id="livereloadscript",t.getElementsByTagName("head")[0].appendChild(s))}(self.document),function(t,s){"object"==typeof exports&&"undefined"!=typeof module?module.exports=s():"function"==typeof define&&define.amd?define(s):(t="undefined"!=typeof globalThis?globalThis:t||self).Two=s()}(this,(function(){"use strict";const t=t=>JSON.parse(JSON.stringify(t)),s=(e,i)=>{if("[object Object]"!==Object.prototype.toString.call(e)||"[object Object]"!==Object.prototype.toString.call(i))return i;for(const o in i)if(Object.prototype.toString.call(e[o])===Object.prototype.toString.call(i[o]))switch(Object.prototype.toString.call(i[o])){case"[object Array]":JSON.stringify(i[o])!==JSON.stringify(e[o])&&(i[o]=t(e[o]));break;case"[object Object]":s(e[o],i[o]);break;case"[object Boolean]":case"[object Number]":case"[object String]":i[o]=e[o]}return i};const e=t=>t.split("-"),i=t=>t.join("-"),o={},h=()=>{let t=r();for(;o[t];)t=r();return t},r=()=>new Array(3).fill(0).map((()=>Math.ceil(255*Math.random()))).concat(255).join("-");var a,n,c,p={object:Object.freeze({__proto__:null,Copy:t,Assign:s}),helper:Object.freeze({__proto__:null,idToRgba:e,rgbaToId:i,createId:h})};!function(t){t.click="click",t.mousedown="mousedown",t.mousemove="mousemove",t.mouseup="mouseup",t.mouseenter="mouseenter",t.mouseleave="mouseleave"}(a||(a={}));class l{id="";width=0;height=0;x=0;y=0;bgcolor="black";borderWidth=1;borderColor="red";fontSize="12px";textColor="black";text="";scaleX=1;scaleY=1;rotation=0;size=10;textList=[];lineHeight=0;lineWidth=0;lateX=0;lateY=0}class d{id;listeners;props=new l;actived=!1;constructor(){this.id=h(),this.props.id=this.id,this.listeners={}}on(t,s){this.listeners[t]?this.listeners[t].push(s):this.listeners[t]=[s]}draw(t,s){throw new Error("Method not implemented.")}transform(t){const{x:s,y:e,width:i,height:o,rotation:h,lateX:r,lateY:a,scaleX:n,scaleY:c}=this.props;t.translate(r,a),t.translate(s,e),t.rotate(Math.PI/180*h),t.scale(n,c),t.translate(-s,-e),t.translate(-i/2,-o/2)}getListeners(){return this.listeners}getRgbaId(){return this.id}setProps(t){p.object.Assign(t,this.props)}get Listeners(){return this.listeners}get Id(){return this.id}}class u extends d{model;hollow;constructor(t){super(),p.object.Assign(t,this.props),this.model=t.model||"fill",this.hollow=t.hollow||!0}draw(t,s){const{x:i,y:o,width:h,height:r,bgcolor:a,borderColor:n,borderWidth:c}=this.props;t.save(),this.transform(t),t.beginPath(),t.fillStyle=a,t.strokeStyle=n,t.lineWidth=c,t.rect(i,o,h,r),"all"==this.model||"fill"==this.model&&t.fill(),"all"==this.model||"stroke"==this.model&&t.stroke(),t.closePath(),t.restore();const[p,l,d,u]=e(this.getRgbaId());s.save(),this.transform(s),s.beginPath(),s.fillStyle=`rgba(${p}, ${l}, ${d}, ${u})`,s.strokeStyle=`rgba(${p}, ${l}, ${d}, ${u})`,s.lineWidth=c,s.rect(i,o,h,r),"all"==this.model||"fill"==this.model||this.hollow&&s.fill(),"all"==this.model||"stroke"==this.model&&s.stroke(),s.fill(),s.stroke(),s.closePath(),s.restore()}}class m extends d{points;size=5;fillStyle="white";constructor(t,s,e="white"){super(),this.points=t,this.size=s,this.fillStyle=e}draw(t,s){t.save(),t.beginPath(),t.fillStyle=this.fillStyle;for(let s=0;s<this.points.length;s++){const[e,i]=this.points[s];t.moveTo(e,i),t.arc(e,i,this.size,0,2*Math.PI)}t.closePath(),t.fill(),t.restore()}}class x{size=20;scene;enable=!1;mousedownFn;mousemoveFn;mouseupFn;points=[];constructor(t){this.scene=t}open(){const{domElement:t,ctx:s,osCtx:e}=this.scene;this.mousedownFn=this.mousedown.bind(this,s,e),this.mousemoveFn=this.mousemove.bind(this,s,e),this.mouseupFn=this.mouseup.bind(this,s,e),t.addEventListener("mousedown",this.mousedownFn),t.addEventListener("mousemove",this.mousemoveFn),t.addEventListener("mouseup",this.mouseupFn)}close(){const{domElement:t}=this.scene;t.removeEventListener("mousedown",this.mousedownFn),t.removeEventListener("mousemove",this.mousemoveFn),t.removeEventListener("mouseup",this.mouseupFn)}draw(t,s,e,i){e.save(),e.beginPath(),e.arc(t,s,this.size,0,2*Math.PI),e.clip(),e.clearRect(0,0,this.scene.width,this.scene.height),e.closePath(),e.restore(),i.save(),i.beginPath(),i.arc(t,s,this.size,0,2*Math.PI),i.clip(),i.clearRect(0,0,this.scene.width,this.scene.height),i.closePath(),i.restore(),this.points.push([t,s])}mousedown=(t,s)=>{this.enable=!0};mousemove=(t,s,e)=>{this.enable&&this.draw(e.offsetX,e.offsetY,t,s)};mouseup=(t,s)=>{const{domElement:e}=this.scene,i=window.getComputedStyle(e,null).getPropertyValue("background-color");this.scene.shapes.push(new m(this.points,this.size,i)),this.scene.setHistory(),this.enable=!1}}class g extends d{pointList=[];constructor(t){super(),p.object.Assign(t,this.props),this.pointList=t.pointList,this.props.x+=this.props.width/2,this.props.y+=this.props.height/2}draw(t,s){const{x:i,y:o,width:h,height:r,bgcolor:a,borderWidth:n,borderColor:c}=this.props;if(!t||!s)return;t.save(),this.transform(t),t.translate(h/2,r/2),t.beginPath(),t.fillStyle=a,t.strokeStyle=c,t.lineWidth=n,this.pointList.forEach((s=>{t.lineTo(s.x,s.y)})),t.stroke(),t.closePath(),t.restore();const[p,l,d,u]=e(this.getRgbaId());s.save(),this.transform(s),s.beginPath(),s.strokeStyle=`rgba(${p}, ${l}, ${d}, ${u})`,s.fillStyle=`rgba(${p}, ${l}, ${d}, ${u})`,s.rect(i,o,h,r),s.fill(),s.closePath(),s.restore()}setProps(t){super.setProps(t),this.props.x+=this.props.width/2,this.props.y+=this.props.height/2}}class b{scene;isMove=!1;addcanvasMousedown;addcanvasMousemove;addcanvasMouseup;wayList=[];size=1;color="black";shape;constructor(t){this.scene=t}open(){const{domElement:t,ctx:s}=this.scene;this.addcanvasMousedown=this.canvasMousedown.bind(this,s),this.addcanvasMousemove=this.canvasMousemove.bind(this,s),this.addcanvasMouseup=this.canvasMouseup.bind(this),t.addEventListener("mousedown",this.addcanvasMousedown),t.addEventListener("mousemove",this.addcanvasMousemove),t.addEventListener("mouseup",this.addcanvasMouseup)}canvasMousedown(t,s){this.wayList.push(),this.wayList.push({x:s.offsetX,y:s.offsetY});const e=new g({pointList:this.wayList});e.props.bgcolor=this.color,e.props.borderWidth=this.size,this.scene.add(e),this.shape=e,this.isMove=!0}canvasMousemove(t,s){this.isMove&&(this.wayList.push({x:s.offsetX,y:s.offsetY}),this.shape.pointList=this.wayList,this.scene.render())}canvasMouseup(t){this.wayList.push({x:t.offsetX,y:t.offsetY});let s=0,e=0,i=0,o=0;this.wayList.forEach(((t,h)=>{0==h&&(i=t.x,o=t.y),t.x>s&&(s=t.x),t.y>e&&(e=t.y),t.x<i&&(i=t.x),t.y<o&&(o=t.y)})),this.shape.setProps(Object.assign(new l,{id:this.shape.id,width:s-i,height:e-o,x:i,y:o})),this.wayList=[],this.scene.setHistory(),this.scene.render(),this.isMove=!1}close(){const{domElement:t}=this.scene;t.removeEventListener("mousedown",this.addcanvasMousedown),t.removeEventListener("mousemove",this.addcanvasMousemove),t.removeEventListener("mouseup",this.addcanvasMouseup)}}!function(t){t.Down="DOWN",t.Up="UP",t.Move="MOVE"}(n||(n={}));class f{listenersMap={};lastDownId="";lastMoveId="";addAction(t,s){const{type:e,id:i}=t;e===n.Move&&this.fire(i,a.mousemove,s),e!==n.Move||this.lastMoveId&&this.lastMoveId===i||(this.fire(i,a.mouseenter,s),this.fire(this.lastMoveId,a.mouseleave,s)),e===n.Down&&this.fire(i,a.mousedown,s),e===n.Up&&this.fire(i,a.mouseup,s),e===n.Up&&this.lastDownId===i&&this.fire(i,a.click,s),e===n.Move?this.lastMoveId=t.id:e===n.Down&&(this.lastDownId=t.id)}addListeners(t,s){this.listenersMap[t]=s}fire(t,s,e){this.listenersMap[t]&&this.listenersMap[t][s]&&this.listenersMap[t][s].forEach((s=>s(e,t)))}}!function(t){t.line="line",t.base="base",t.top="top",t.right="right",t.bottom="bottom",t.left="left",t.scale="scale",t.topL="topL",t.topR="topR",t.bottomL="bottomL",t.bottomR="bottomR"}(c||(c={}));const v=[c.line,c.base,c.top,c.right,c.bottom,c.left,c.scale,c.topL,c.topR,c.bottomL,c.bottomR];class w extends d{shapeMap=new Map;WIDTH=15;HEIGHT=15;borderColor="rgba(71, 154, 227, 1)";constructor(t){super(),p.object.Assign(t,this.props),v.forEach((t=>{this.shapeMap.set((new d).getRgbaId(),t)}))}handlePoints(){const{x:t,y:s,width:e}=this.props;return[{x:t+e/2,y:s-this.HEIGHT/2},{x:t+e/2,y:s-2*this.HEIGHT+this.HEIGHT/2}]}handleProps(t){const{x:s,y:e,width:i,height:o}=this.props;let h=0,r=0,a=this.WIDTH,n=this.HEIGHT;switch(t){case c.base:h=s,r=e,a=i,n=o;break;case c.top:h=s,r=e-o/2;break;case c.bottom:h=s,r=e+o/2;break;case c.left:h=s-i/2,r=e;break;case c.right:h=s+i/2,r=e;break;case c.topL:h=s-i/2,r=e-o/2;break;case c.topR:h=s+i/2,r=e-o/2;break;case c.bottomL:h=s-i/2,r=e+o/2;break;case c.bottomR:h=s+i/2,r=e+o/2;break;case c.scale:h=s,r=e-o/2-2*n}return{x:t==c.base?h:h+i/2-a/2,y:t==c.base?r:r+o/2-n/2,width:a,height:n}}draw(t,s){const{bgcolor:i,borderColor:o,borderWidth:h}=this.props;t.save(),this.transform(t),t.fillStyle=i,t.strokeStyle=o,t.lineWidth=h,this.shapeMap.forEach(((s,e)=>{if(t.beginPath(),s==c.line){const s=this.handlePoints();t.lineTo(s[0].x,s[0].y),t.lineTo(s[1].x,s[1].y)}else{const{x:e,y:i,width:o,height:h}=this.handleProps(s);t.rect(e,i,o,h)}t.stroke(),t.closePath()})),t.restore(),s.save(),this.transform(s),s.beginPath(),s.lineWidth=h,this.shapeMap.forEach(((t,i)=>{const[o,h,r,a]=e(i);if(s.fillStyle=`rgba(${o}, ${h}, ${r}, ${a})`,s.strokeStyle=`rgba(${o}, ${h}, ${r}, ${a})`,s.beginPath(),t==c.line){const t=this.handlePoints();s.lineTo(t[0].x,t[0].y),s.lineTo(t[1].x,t[1].y)}else{const{x:e,y:i,width:o,height:h}=this.handleProps(t);s.rect(e,i,o,h)}t==c.line||t==c.base?s.stroke():s.fill(),s.closePath()})),s.restore()}setProps(t){super.setProps(t),this.props.borderColor=this.borderColor,this.props.width*=this.props.scaleX,this.props.height*=this.props.scaleY,this.props.scaleX=1,this.props.scaleY=1}}class y{x=0;y=0}class L{state=0;scene;enable=!1;type="shape";activedId="";shape;activeShape;point={pre:new y,cur:new y,tl:new y,tr:new y,bl:new y,br:new y};mousemove;mouseup;constructor(t){this.scene=t}open(){this.state=1,this.shape=new w({x:0,y:0,widht:0,height:0}),this.scene.shapes.push(this.shape),this.scene.eventSimulator.addListeners(this.shape.getRgbaId(),this.shape.getListeners()),this.shape.shapeMap.forEach(((t,s)=>{this.scene.IDS.add(s)})),this.mousemove=this.handleMousemove.bind(this),this.mouseup=this.handleMouseup.bind(this),document.addEventListener("mousemove",this.mousemove),document.addEventListener("mouseup",this.mouseup)}close(){this.state=0;const t=this.shape.getRgbaId(),s=this.scene.shapes.findIndex((s=>s.getRgbaId()==t));s>-1&&this.scene.shapes.splice(s,1),this.scene.IDS.has(t)&&this.scene.IDS.delete(t),document.removeEventListener("mousemove",this.mousemove),document.removeEventListener("mouseup",this.mouseup)}handleMousemove(t){if(!this.enable)return;const{activeShape:s,shape:e,type:i,point:o}=this;o.cur.x=t.offsetX,o.cur.y=t.offsetY;const h=o.cur.x-o.pre.x,r=o.cur.y-o.pre.y;if(s){switch(i){case"shape":s.props.lateX+=h,s.props.lateY+=r,e.props.lateX+=h,e.props.lateY+=r,e.props.borderColor="rgba(71, 154, 227, 0.5)";break;case"frame":const t=1+(e.props.width-s.props.width)/s.props.width||1,i=1+(e.props.height-s.props.height)/s.props.height||1,a=(t=!0,i=!0)=>{const a=e.props.rotation*Math.PI/180;let n=0,p=0;if(t&&!i)n=h/2*Math.cos(a),p=h/2*Math.sin(a);else if(!t&&i)n=r/2*Math.sin(-a),p=r/2*Math.cos(-a);else if(t&&i){const{width:t,height:s}=e.props;let i,h,r;switch(i=h=r="tl",e.shapeMap.get(this.activedId)){case c.topL:i="br",h="bl",r="tr";break;case c.topR:i="bl",h="tl",r="br";break;case c.bottomL:i="tr",h="tl",r="br";break;case c.bottomR:i="tl",h="bl",r="tr"}const a=o[r].x-o[i].x,l=o[r].y-o[i].y,d=o[h].x-o[i].x,u=o[h].y-o[i].y,m=180*Math.atan2(l,a)/Math.PI,x=180*Math.atan2(u,d)/Math.PI,g=o[i].x+t*Math.cos(m*Math.PI/180),b=o[i].y+t*Math.sin(m*Math.PI/180),f=o[i].x+s*Math.cos(x*Math.PI/180),v=o[i].y+s*Math.sin(x*Math.PI/180);return n=f+(g-f)/2,void(p=v+(b-v)/2)}e.props.lateX+=n,e.props.lateY+=p,s.props.lateX+=n,s.props.lateY+=p};switch(e.shapeMap.get(this.activedId)){case c.left:e.props.width-=h,s.props.scaleX=t,a(!0,!1);break;case c.right:e.props.width+=h,s.props.scaleX=t,a(!0,!1);break;case c.top:e.props.height-=r,s.props.scaleY=i,a(!1,!0);break;case c.bottom:e.props.height+=r,s.props.scaleY=i,a(!1,!0);break;case c.topL:e.props.width-=h,e.props.height-=r,s.props.scaleX=t,s.props.scaleY=i,a(!0,!0);break;case c.topR:e.props.width+=h,e.props.height-=r,s.props.scaleX=t,s.props.scaleY=i,a(!0,!0);break;case c.bottomL:e.props.width-=h,e.props.height+=r,s.props.scaleX=t,s.props.scaleY=i,a(!0,!0);break;case c.bottomR:e.props.width+=h,e.props.height+=r,s.props.scaleX=t,s.props.scaleY=i,a(!0,!0);break;case c.scale:const n=o.cur.x-(e.props.x+e.props.lateX),p=o.cur.y-(e.props.y+e.props.lateY),l=180*Math.atan2(p,n)/Math.PI+90;e.props.rotation=l,s.props.rotation=l}}this.scene.render()}o.pre.x=t.offsetX,o.pre.y=t.offsetY}handleMouseup(){this.enable&&"shape"==this.type&&(this.shape.props.borderColor="rgba(71, 154, 227, 1)",document.body.style.cursor="default",this.scene.render()),this.enable=!1}handleFrameBox(t,s,e){if(0==this.state||t!=n.Down)return;const{shapes:i,historyID:o}=this.scene,{shape:h,point:r}=this;if(h.shapeMap.get(s)){this.type="frame",this.activedId=s,r.pre.x=e.offsetX,r.pre.y=e.offsetY;const t=t=>{const{x:s,y:e,width:i,height:o,rotation:r}=h.props,a=Math.sqrt(i*i+o*o)/2;return{x:s+a*Math.cos((r+t)*Math.PI/180),y:e+a*Math.sin((r+t)*Math.PI/180)}};return r.tl=t(-135),r.tr=t(-45),r.bl=t(135),r.br=t(45),void(this.enable=!0)}this.activeShape=null,i.forEach((t=>{t.actived=!1,t.getRgbaId()==s&&(t.actived=!0,this.activeShape=t,this.type="shape",document.body.style.cursor="move",r.pre.x=e.offsetX,r.pre.y=e.offsetY,this.enable=!0)}));const a=o.indexOf(h.getRgbaId());this.activeShape?(this.shape.setProps(this.activeShape.props),-1==a&&o.push(h.getRgbaId())):-1!=a&&o.splice(a,1),this.scene.render()}}class M{canvas;osCanvas;ctx;osCtx;dpr;width=300;height=250;eventSimulator;IDS;historyID=[];shapes;shapesEvent;constructor(t){t&&(this.width=t.width||300,this.height=t.height||250),this.canvas=document.createElement("canvas"),this.osCanvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.osCanvas.width=this.width,this.osCanvas.height=this.height,this.osCanvas.id="bagua",this.ctx=this.canvas.getContext("2d"),this.osCtx=this.osCanvas.getContext("2d"),this.ctx?.scale(1,1),this.osCtx?.scale(1,1),this.dpr=1,this.canvas.addEventListener("mousedown",this.handleCreator(n.Down)),this.canvas.addEventListener("mouseup",this.handleCreator(n.Up)),this.canvas.addEventListener("mousemove",this.handleCreator(n.Move)),this.eventSimulator=new f,this.shapes=new Array,this.IDS=new Set,this.shapesEvent=new L(this),this.shapesEvent.open(),document.querySelector("#app")?.appendChild(this.osCanvas)}handleCreator=t=>s=>{const e=s.offsetX,i=s.offsetY,o=this.hitJudge(e,i);this.shapesEvent.handleFrameBox(t,o,s),this.eventSimulator.addAction({type:t,id:o},s)};hitJudge(t,s){if(!this.osCtx)return"";const e=Array.from(this.osCtx.getImageData(t*this.dpr,s*this.dpr,1,1).data),o=i(e);return this.IDS.has(o)?o:""}add(t){this.shapes.push(t),this.eventSimulator.addListeners(t.getRgbaId(),t.getListeners()),this.IDS.add(t.getRgbaId()),this.historyID.push(t.getRgbaId())}render(){if(!this.ctx||!this.osCtx)throw new Error("渲染失败");this.clearCanvas();for(let t=0;t<this.shapes.length;t++)-1!=this.historyID.indexOf(this.shapes[t].getRgbaId())&&this.shapes[t].draw(this.ctx,this.osCtx)}clearCanvas(){this.ctx.clearRect(0,0,this.width,this.height),this.osCtx.clearRect(0,0,this.width,this.height)}get domElement(){return this.canvas}}class E extends d{count=0;textRow=0;constructor(t){super(),p.object.Assign(t,this.props)}draw(t,s){const{x:i,y:o,size:h,lineHeight:r,width:a}=this.props;if(!t||!s)return;let n=0;t.font=`${h}px Arial`,n=t.measureText("你好").actualBoundingBoxDescent,t.clearRect(0,0,1e3,1e3),t.save(),t.beginPath(),t.rect(i+(a+this.count),o+h*(this.textRow-1)+n,0,h),t.closePath(),t.stroke(),t.restore();const[c,p,l,d]=e(this.getRgbaId());s.beginPath(),s.strokeStyle=`rgba(${c}, ${p}, ${l}, ${d})`,s.rect(i+(a+this.count),o+r,0,h),s.stroke(),s.closePath()}}class k extends d{constructor(t){super(),p.object.Assign(t,this.props)}draw(t,s){const{textList:i,x:o,y:h,size:r}=this.props;let{lineHeight:a}=this.props;if(!t||!s)return;t.save(),t.beginPath(),t.font=`${r}px Arial`,i.forEach(((s,e)=>{a=e*r,t.fillText(s,o,h+a)})),t.closePath(),t.stroke(),t.restore();const[n,c,p,l]=e(this.getRgbaId());s.save(),s.beginPath(),s.font=`${r}px Arial`,s.strokeStyle=`rgba(${n}, ${c}, ${p}, ${l})`,i.forEach((t=>{s.fillText(t,o,h+a)})),s.stroke(),s.closePath(),s.restore()}}class R{scene;ctx;textDom;cursor;time;addcanvasMousedown;mouseupfN;keyDownFn;keyUpFn;inputFn;size=10;textOb;cursorLength=0;moveCursorStatus=!1;textList=[];textRow=0;lineHeight=0;constructor(t){this.scene=t,this.ctx=t.ctx,this.textDom=document.createElement("textarea"),this.textDom.setAttribute("id","mytextarea"),this.textDom.setAttribute("autocapitalize","off"),this.textDom.setAttribute("autocorrect","off"),this.textDom.setAttribute("autocomplete","off"),this.textDom.setAttribute("spellcheck","false"),this.lineHeight=this.getTextHeight(this.size)}open(){this.ctx&&(this.initEvent(),this.cursor=new E({x:0,y:0,size:this.size,lineHeight:this.lineHeight}),this.scene.add(this.cursor))}canvasMouseup(){document.getElementById("mytextarea")?.focus()}canvasMousedown(t){this.ctx&&(this.time&&clearInterval(this.time),this.initText(t),this.initCursor(t))}input(){this.textList=this.textDom.value.split("\n"),console.log(this.textList),this.textOb.props.x=this.cursor.props.x,this.textOb.props.y=this.cursor.props.y,this.textOb.props.textList=this.textList,this.cursor.props.width=this.getTextWidth(this.textList[this.textRow],this.size),this.cursor.props.text=this.textList[this.textRow],this.moveCursorStatus=!1}close(){this.time&&clearInterval(this.time)}animation(){this.time=setInterval((()=>{this.cursor.props.size<this.size?this.cursor.props.size=this.size:this.cursor.props.size=0,this.scene.render()}),200)}keyDown(t){let s=this.textList[this.textRow];if(!this.ctx)return;let e=0;switch(t.key){case"ArrowLeft":this.cursorLength>=0&&(this.recountLength(s),this.moveCursorStatus=!0,console.log("left",s.charAt(this.cursorLength),this.cursorLength),e=this.getTextWidth(s.charAt(this.cursorLength),this.size),this.cursor.count-=e,this.cursorLength--);break;case"ArrowRight":this.cursorLength<s.length-1&&(this.cursorLength++,console.log("right",s.charAt(this.cursorLength)),e=this.getTextWidth(s.charAt(this.cursorLength),this.size),this.cursor.count+=e);break;case"ArrowUp":if(this.textList.length>1&&this.textRow>0){this.textRow--,this.cursor.textRow=this.textRow,this.textOb.props.textRow=this.textRow,this.recountLength(this.textList[this.textRow]),console.log("上",this.textList[this.textRow],this.textRow);break}0==this.textRow&&s&&(this.recountLength(s),e=this.getTextWidth(s.slice(0,this.cursorLength+1),this.size),this.cursor.count-=e,this.cursorLength=-1);break;case"ArrowDown":if(this.textList.length>1&&this.textRow<this.textList.length-1){this.textRow++,this.cursor.textRow=this.textRow,this.textOb.props.textRow=this.textRow,this.recountLength(this.textList[this.textRow]),console.log("下",this.textList[this.textRow],this.textRow);break}0==this.textRow&&s&&(this.recountLength(s),e=this.getTextWidth(s.slice(this.cursorLength+1),this.size),this.cursor.count+=e,this.cursorLength=this.textList[this.textRow].length-1)}}keyUp(t){if(this.ctx&&"Enter"===t.key)this.textRow++,this.cursor.textRow=this.textRow,this.textOb.props.textRow=this.textRow,this.cursor.props.width=this.getTextWidth(this.textList[this.textRow],this.size)}initText(t){this.cursor.props.text="",this.textDom.value="",this.textOb=new k({size:this.size,textList:this.textList,lineHeight:this.lineHeight}),this.scene.add(this.textOb),this.textDom.style.cssText=`position:absolute;width:200px;height:50px;left:${t.clientX-50}px;top:${t.clientY-50}px;opacity:1`,document.body.appendChild(this.textDom),this.textDom.addEventListener("input",this.inputFn)}initCursor(t){this.cursor.props.x=t.offsetX,this.cursor.props.y=t.offsetY,this.cursor.count=0,this.moveCursorStatus=!1,this.animation()}initEvent(){const{domElement:t}=this.scene;this.addcanvasMousedown=this.canvasMousedown.bind(this),this.mouseupfN=this.canvasMouseup,this.inputFn=this.input.bind(this),this.keyDownFn=this.keyDown.bind(this),this.keyUpFn=this.keyUp.bind(this),t.addEventListener("mousedown",this.addcanvasMousedown),document.addEventListener("keydown",this.keyDownFn),document.addEventListener("keyup",this.keyUpFn),document.addEventListener("mouseup",this.mouseupfN)}recountLength(t){if(!this.moveCursorStatus){let s=t.length-1,e=0;for(;parseInt(this.cursor.count)&&(e=this.getTextWidth(t.slice(s),this.size),s--,!(e+this.cursor.count==0||s<0)););this.cursorLength=s,console.log("重算光标",this.cursorLength)}}getTextHeight(t){return this.ctx?(this.ctx.font=`${t}px Arial`,this.ctx.measureText("你好").actualBoundingBoxAscent):0}getTextWidth(t,s){return this.ctx?(this.ctx.font=`${s}px Arial`,this.ctx.measureText(t).width):0}resetText(){this.moveCursorStatus=!1}}class I{steps=0;steps_run=0;history=[];setHistory(t,s){const e=t?1:-1;this.steps+=e,this.steps_run+=e,t&&s?this.history.push(s):this.history.pop()}back(){this.steps_run>0&&this.steps_run--}go(){this.steps_run<this.steps&&this.steps_run++}push(t){if(!t)throw new Error("请传入数据");this.setHistory(1,t)}pop(){this.setHistory(0)}getCurrent(){return 0==this.steps_run?null:this.history[this.steps_run-1]}clear(){this.steps=0,this.steps_run=0,this.history.length=0}getSteps(){return this.steps}getCurSteps(){return this.steps_run}}return{drawiBoardBagua:class extends M{history=new I;model="normal";erase;pen;textarea;scale=1;ratio=.5;offsetx=0;offsety=0;rollerEventfn;constructor(t){super(t),this.erase=new x(this),this.pen=new b(this),this.textarea=new R(this),this.rollerEventfn=this.rollerEvent.bind(this),this.initRollerEvent()}setModel(t){switch(this.model=t,t){case"erase":this.erase.open(),this.pen.close(),this.shapesEvent.close(),this.textarea.close();break;case"pen":this.pen.open(),this.erase.close(),this.shapesEvent.close(),this.textarea.close();break;case"textarea":this.textarea.open(),this.pen.close(),this.erase.close(),this.shapesEvent.close();break;case"normal":this.shapesEvent.open(),this.erase.close(),this.pen.close(),this.textarea.close()}}setHistory(){const t=this.shapes.map((t=>p.object.Copy(t.props)));this.history.push({name:"shapes",data:t})}setShapes(){this.shapes.forEach((t=>{this.history.getCurrent()?.data.forEach((s=>{t.getRgbaId()==s.id&&t.setProps(s)}))})),this.historyID=this.history.getCurrent()?.data.map((t=>t.id))||[]}revokeCanvas(){this.history.back(),this.setShapes(),this.render()}recoverCanvas(){this.history.go(),this.setShapes(),this.render()}resetCanvas(){this.history.clear(),this.clearCanvas()}amplify(t,s){if(this.scale>=5)return;const e=this.domElement,{width:i,height:o}=this;t&&s||(t=i/2,s=o/2),this.scale+=this.ratio,e.style.transformOrigin=`${t}px ${s}px`,e.style.transform=`scale(${this.scale})`}reduce(t,s){if(this.scale<=.2)return;const e=this.domElement,{width:i,height:o}=this;t&&s||(t=i/2,s=o/2),this.scale=this.scale-this.ratio<.2?.2:this.scale-this.ratio,e.style.transformOrigin=`${t}px ${s}px`,e.style.transform=`scale(${this.scale})`}moveCanvas(t,s){const e=this.domElement;switch(t){case"top":this.offsety-=s;break;case"bottom":this.offsety+=s;break;case"left":this.offsetx-=s;break;case"right":this.offsetx+=s}e.style.transform=`translate(${this.offsetx}px,${this.offsety}px)`}initRollerEvent(){this.domElement.addEventListener("wheel",this.rollerEventfn)}rollerEvent(t){t.preventDefault(),t.deltaY<0?this.amplify(t.offsetX,t.offsetY):this.reduce(t.offsetX,t.offsetY)}closeRollerEvent(){this.domElement.removeEventListener("wheel",this.rollerEventfn)}Rect(t){const s=new u(t);this.add(s),this.render(),this.setHistory()}},Rect:u}}));
//# sourceMappingURL=index.js.map
